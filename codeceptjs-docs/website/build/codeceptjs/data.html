<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Data Management · CodeceptJS</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&gt; This chapter describes data management for external sources. If you are looking for using Data Sets in tests, see [Data Driven Tests](http://codecept.io/advanced/#data-drivern-tests) section*"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Data Management · CodeceptJS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://codecept.io/"/><meta property="og:description" content="&gt; This chapter describes data management for external sources. If you are looking for using Data Sets in tests, see [Data Driven Tests](http://codecept.io/advanced/#data-drivern-tests) section*"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-30075781-3"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-30075781-3');
            </script><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans"/><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.svg" alt="CodeceptJS"/><h2 class="headerTitleWithLogo">CodeceptJS</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/quickstart" target="_self">Quickstart</a></li><li class="siteNavGroupActive"><a href="/basics" target="_self">Guides</a></li><li class=""><a href="/reference" target="_self">API</a></li><li class=""><a href="/changelog" target="_self">Releases</a></li><li class=""><a href="/help" target="_self">Support</a></li><li class=""><a href="https://github.com/Codeception/CodeceptJS" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Organizing Tests</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Web Testing</h3><ul class=""><li class="navListItem"><a class="navItem" href="/basics">Basics</a></li><li class="navListItem"><a class="navItem" href="/webdriver">Testing with WebDriver</a></li><li class="navListItem"><a class="navItem" href="/puppeteer">Testing with Puppeteer</a></li><li class="navListItem"><a class="navItem" href="/testcafe">Testing with TestCafe</a></li><li class="navListItem"><a class="navItem" href="/angular">Testing with Protractor</a></li><li class="navListItem"><a class="navItem" href="/nightmare">Testing with Nightmare</a></li><li class="navListItem"><a class="navItem" href="/visual">Visual Testing</a></li><li class="navListItem"><a class="navItem" href="/email">Email Testing</a></li><li class="navListItem"><a class="navItem" href="/react">Testing React Applications</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Mobile Testing</h3><ul class=""><li class="navListItem"><a class="navItem" href="/mobile">Mobile Testing with Appium</a></li><li class="navListItem"><a class="navItem" href="/detox">Testing React Native with Detox</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Organizing Tests</h3><ul class=""><li class="navListItem"><a class="navItem" href="/best">Best Practices</a></li><li class="navListItem"><a class="navItem" href="/locators">Locators</a></li><li class="navListItem"><a class="navItem" href="/pageobjects">Page Objects</a></li><li class="navListItem"><a class="navItem" href="/helpers">Custom Helpers</a></li><li class="navListItem"><a class="navItem" href="/bdd">Behavior Driven Development</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/data">Data Management</a></li><li class="navListItem"><a class="navItem" href="/parallel">Parallel Execution</a></li><li class="navListItem"><a class="navItem" href="/reports">Reporters</a></li><li class="navListItem"><a class="navItem" href="/advanced">Advanced Usage</a></li><li class="navListItem"><a class="navItem" href="/hooks">Bootstrap / Teardown / Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul class=""><li class="navListItem"><a class="navItem" href="/books">Books &amp; Posts</a></li><li class="navListItem"><a class="navItem" href="/videos">Videos</a></li><li class="navListItem"><a class="navItem" href="/examples">Examples</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/Codeception/CodeceptJS/blob/master/docs/data.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Data Management</h1></header><article><div><span><blockquote>
<p>This chapter describes data management for external sources. If you are looking for using Data Sets in tests, see <a href="http://codecept.io/advanced/#data-drivern-tests">Data Driven Tests</a> section*</p>
</blockquote>
<p>Managing data for tests is always a tricky issue. How isolate data between tests, how to prepare data for different tests, etc.
There are different approaches to solve it:</p>
<ol>
<li>reset database completely between tests</li>
<li>create unique non-intersecting data sets per each test</li>
<li>create and delete data for a test</li>
</ol>
<p>The most efficient way would be to allow test to control its data, i.e. the 3rd option.
However, accessing database directly is not a good idea as database vendor, schema and data are used by application internally and are out of scope of acceptance test.</p>
<p>Today all modern web applications have REST or GraphQL API . So it is a good idea to use it to create data for a test and delete it after.
API is supposed to be a stable interface and it can be used by acceptance tests. CodeceptJS provides 4 helpers for Data Management via REST and GraphQL API.</p>
<h2><a class="anchor" aria-hidden="true" id="rest"></a><a href="#rest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>REST</h2>
<p><a href="http://codecept.io/helpers/REST/">REST helper</a> allows sending raw HTTP requests to application.
This is a tool to make shortcuts and create your data pragmatically via API. However, it doesn't provide tools for testing APIs, so it should be paired with WebDriver, Nightmare or Protractor helpers for browser testing.</p>
<p>Enable REST helper in the config. It is recommended to set <code>endpoint</code>, a base URL for all API requests. If you need some authorization you can optionally set default headers too.</p>
<p>See the sample config:</p>
<pre><code class="hljs css language-js">helpers: {
  <span class="hljs-attr">REST</span>: {
    <span class="hljs-attr">endpoint</span>: <span class="hljs-string">"http://localhost/api/v1/"</span>,
    <span class="hljs-attr">defaultHeaders</span>: {
      <span class="hljs-string">'Auth'</span>: <span class="hljs-string">'11111'</span>,
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
    },
  },
  <span class="hljs-attr">WebDriver</span> : {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'http://localhost'</span>,
    <span class="hljs-attr">browser</span>: <span class="hljs-string">'chrome'</span>
  }
}
</code></pre>
<p>REST helper provides basic methods to send requests to application:</p>
<pre><code class="hljs css language-js"><span class="hljs-built_in">I</span>.sendGetRequest()
<span class="hljs-built_in">I</span>.sendPostRequest()
<span class="hljs-built_in">I</span>.sendPutRequest()
<span class="hljs-built_in">I</span>.sendPatchRequest()
<span class="hljs-built_in">I</span>.sendDeleteRequest()
</code></pre>
<p>As well as a method for setting headers: <code>haveRequestHeaders</code>.</p>
<p>Here is a usage example:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">let</span> postId = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">Scenario</span>(<span class="hljs-string">'check post page'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-built_in">I</span>)  =&gt; {
  <span class="hljs-comment">// valid access token</span>
  <span class="hljs-built_in">I</span>.haveRequestHeaders({<span class="hljs-attr">auth</span>: <span class="hljs-string">'1111111'</span>});
  <span class="hljs-comment">// get the first user</span>
  <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> <span class="hljs-built_in">I</span>.sendGetRequest(<span class="hljs-string">'/api/users/1'</span>);
  <span class="hljs-comment">// create a post and save its Id</span>
  postId = <span class="hljs-keyword">await</span> <span class="hljs-built_in">I</span>.sendPostRequest(<span class="hljs-string">'/api/posts'</span>, { <span class="hljs-attr">author</span>: user.id, <span class="hljs-attr">body</span>: <span class="hljs-string">'some text'</span> });
  <span class="hljs-comment">// open browser page of new post</span>
  <span class="hljs-built_in">I</span>.amOnPage(<span class="hljs-string">'/posts/2.html'</span>);
  <span class="hljs-built_in">I</span>.see(<span class="hljs-string">'some text'</span>, <span class="hljs-string">'p.body'</span>);
});

<span class="hljs-comment">// cleanup created data</span>
<span class="hljs-keyword">After</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">I</span></span>) =&gt;</span> {
  <span class="hljs-built_in">I</span>.sendDeleteRequest(<span class="hljs-string">'/api/posts/'</span>+postId);
});
</code></pre>
<p>This can also be used to emulate Ajax requests:</p>
<pre><code class="hljs css language-js"><span class="hljs-built_in">I</span>.sendPostRequest(<span class="hljs-string">'/update-status'</span>, {}, { <span class="hljs-attr">http_x_requested_with</span>: <span class="hljs-string">'xmlhttprequest'</span> });
</code></pre>
<blockquote>
<p>See complete reference on <a href="http://codecept.io/helpers/REST">REST</a> helper</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="graphql"></a><a href="#graphql" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GraphQL</h2>
<p><a href="http://codecept.io/helpers/GraphQL/">GraphQL helper</a> allows sending GraphQL queries and mutations to application, over Http.
This is a tool to make shortcuts and create your data pragmatically via GraphQL endpoint. However, it doesn't provide tools for testing the endpoint, so it should be paired with WebDriver, Nightmare or Protractor helpers for browser testing.</p>
<p>Enable GraphQL helper in the config. It is recommended to set <code>endpoint</code>, the URL to which the requests go to. If you need some authorization you can optionally set default headers too.</p>
<p>See the sample config:</p>
<pre><code class="hljs css language-js">helpers: {
  <span class="hljs-attr">GraphQL</span>: {
    <span class="hljs-attr">endpoint</span>: <span class="hljs-string">"http://localhost/graphql/"</span>,
    <span class="hljs-attr">defaultHeaders</span>: {
      <span class="hljs-string">'Auth'</span>: <span class="hljs-string">'11111'</span>,
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
    },
  },
  <span class="hljs-attr">WebDriver</span> : {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'http://localhost'</span>,
    <span class="hljs-attr">browser</span>: <span class="hljs-string">'chrome'</span>
  }
}
</code></pre>
<p>GraphQL helper provides two basic methods to queries and mutations to application:</p>
<pre><code class="hljs css language-js"><span class="hljs-built_in">I</span>.sendQuery()
<span class="hljs-built_in">I</span>.sendMutation()
</code></pre>
<p>As well as a method for setting headers: <code>haveRequestHeaders</code>.</p>
<p>Here is a usage example:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">let</span> postData = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">Scenario</span>(<span class="hljs-string">'check post page'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-built_in">I</span>)  =&gt; {
  <span class="hljs-comment">// valid access token</span>
  <span class="hljs-built_in">I</span>.haveRequestHeaders({<span class="hljs-attr">auth</span>: <span class="hljs-string">'1111111'</span>});
  <span class="hljs-comment">// get the first user</span>
  <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-built_in">I</span>.sendQuery(<span class="hljs-string">'{ user(id:1) { id }}'</span>);
  <span class="hljs-keyword">let</span> user = response.data;
  <span class="hljs-comment">// create a post and save its Id</span>
  response = <span class="hljs-keyword">await</span> <span class="hljs-built_in">I</span>.sendMutation(
    <span class="hljs-string">'mutation createPost($input: PostInput!) { createPost(input: $input) { id }}'</span>,
    { 
      <span class="hljs-attr">input</span> : {
        <span class="hljs-attr">author</span>: user.data.id,
        <span class="hljs-attr">body</span>: <span class="hljs-string">'some text'</span>,
      }
    },
  );
  postData = response.data.data[<span class="hljs-string">'createPost'</span>];
  <span class="hljs-comment">// open browser page of new post</span>
  <span class="hljs-built_in">I</span>.amOnPage(<span class="hljs-string">`/posts/<span class="hljs-subst">${postData.slug}</span>.html`</span>);
  <span class="hljs-built_in">I</span>.see(postData.body, <span class="hljs-string">'p.body'</span>);
});

<span class="hljs-comment">// cleanup created data</span>
<span class="hljs-keyword">After</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">I</span></span>) =&gt;</span> {
  <span class="hljs-built_in">I</span>.sendMutation(
    <span class="hljs-string">'mutation deletePost($id: ID!) { deletePost(id: $id) }'</span>,
    { <span class="hljs-attr">id</span>: postData.id},
  );
});
</code></pre>
<blockquote>
<p>See complete reference on <a href="http://codecept.io/helpers/GraphQL">GraphQL</a> helper</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="data-generation-with-factories"></a><a href="#data-generation-with-factories" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data Generation with Factories</h2>
<p>This concept is extended by:</p>
<ul>
<li><a href="http://codecept.io/helpers/ApiDataFactory/">ApiDataFactory</a> helper, and,</li>
<li><a href="http://codecept.io/helpers/GraphQLDataFactory/">GraphQLDataFactory</a> helper.</li>
</ul>
<p>These helpers build data according to defined rules and use REST API or GraphQL mutations to store them and automatically clean them up after a test.</p>
<p>Just define how many items of any kind you need and the data factory helper will create them for you.</p>
<p>To make this work some preparations are required.</p>
<p>At first, you need data generation libraries which are <a href="https://github.com/rosiejs/rosie">Rosie</a> and <a href="https://www.npmjs.com/package/faker">Faker</a>. Faker can generate random names, emails, texts, and Rosie uses them
to generate objects using factories.</p>
<p>Install rosie and faker to create a first factory:</p>
<pre><code class="hljs css language-js">npm i rosie faker --save-dev
</code></pre>
<p>Then create a module which will export a factory for an entity.
And add that module as a part of the configuration for the helper.</p>
<p>Please look at the respective Factory sections for examples for factory modules and configuration.</p>
<h3><a class="anchor" aria-hidden="true" id="api-data-factory"></a><a href="#api-data-factory" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Data Factory</h3>
<p>This helper uses REST API to store the built data and automatically clean them up after a test,
The way for setting data for a test is as simple as writing:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// inside async function</span>
<span class="hljs-keyword">let</span> post = <span class="hljs-keyword">await</span> <span class="hljs-built_in">I</span>.have(<span class="hljs-string">'post'</span>);
<span class="hljs-built_in">I</span>.haveMultiple(<span class="hljs-string">'comment'</span>, <span class="hljs-number">5</span>, { <span class="hljs-attr">postId</span>: post.id});
</code></pre>
<p>After completing the preparations under 'Data Generation with Factories', create a factory module which will export a factory.</p>
<p>See the example providing a factory for User generation:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// factories/post.js</span>
<span class="hljs-keyword">var</span> Factory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rosie'</span>).Factory;
<span class="hljs-keyword">var</span> faker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'faker'</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">new</span> Factory()
  .attr(<span class="hljs-string">'name'</span>, () =&gt; faker.name.findName())
  .attr(<span class="hljs-string">'email'</span>, () =&gt; faker.internet.email());
</code></pre>
<p>Next is to configure helper to match factories with API:</p>
<pre><code class="hljs css language-js"> ApiDataFactory: {
   <span class="hljs-attr">endpoint</span>: <span class="hljs-string">"http://user.com/api"</span>,
   <span class="hljs-attr">headers</span>: {
     <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
     <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
   },
   <span class="hljs-attr">factories</span>: {
     <span class="hljs-attr">user</span>: {
        <span class="hljs-attr">uri</span>: <span class="hljs-string">"/users"</span>,
        <span class="hljs-attr">factory</span>: <span class="hljs-string">"./factories/user"</span>
     }
   }
 }
</code></pre>
<p>Then, calling <code>I.have('user')</code> inside a test will create a new user for you.
This is done by sending POST request to <code>/api/users</code> URL. Response is returned and can be used in tests.</p>
<p>At the end of a test ApiDataFactory will clean up created record for you. This is done by collecting
ids from crated records and running <code>DELETE /api/users/{id}</code> requests at the end of a test.
This rules can be customized in helper configuration.</p>
<blockquote>
<p>See complete reference on <a href="http://codecept.io/helpers/ApiDataFactory">ApiDataFactory</a> helper</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="graphql-data-factory"></a><a href="#graphql-data-factory" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GraphQL Data Factory</h3>
<p>The helper uses GraphQL mutations to store the built data and automatically clean them up after a test.
This way for setting data for a test is as simple as writing:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// inside async function</span>
<span class="hljs-keyword">let</span> post = <span class="hljs-keyword">await</span> <span class="hljs-built_in">I</span>.mutateData(<span class="hljs-string">'createPost'</span>);
<span class="hljs-built_in">I</span>.mutateMultiple(<span class="hljs-string">'createComment'</span>, <span class="hljs-number">5</span>, { <span class="hljs-attr">postId</span>: post.id});
</code></pre>
<p>After completing the preparations under 'Data Generation with Factories', create a factory module which will export a factory.</p>
<p>The object built by the factory is sent as the variables object along with the mutation. So make sure it matches the argument type as detailed in the GraphQL schema. You may want to pass a constructor to the factory to achieve that.</p>
<p>See the example providing a factory for User generation:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// factories/post.js</span>
<span class="hljs-keyword">var</span> Factory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rosie'</span>).Factory;
<span class="hljs-keyword">var</span> faker = <span class="hljs-built_in">require</span>(<span class="hljs-string">'faker'</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">new</span> Factory(<span class="hljs-function">(<span class="hljs-params">buildObj</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">input</span>: { ...buildObj },
  }
})
  .attr(<span class="hljs-string">'name'</span>, () =&gt; faker.name.findName())
  .attr(<span class="hljs-string">'email'</span>, () =&gt; faker.internet.email());
</code></pre>
<p>Next is to configure helper to match factories with API:</p>
<pre><code class="hljs css language-js">GraphQLDataFactory: {
  <span class="hljs-attr">endpoint</span>: <span class="hljs-string">"http://user.com/graphql"</span>,
  <span class="hljs-attr">cleanup</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
    <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
  },
  <span class="hljs-attr">factories</span>: {
    <span class="hljs-attr">createUser</span>: {
      <span class="hljs-attr">query</span>: <span class="hljs-string">'mutation createUser($input: UserInput!) { createUser(input: $input) { id name }}'</span>,
      <span class="hljs-attr">factory</span>: <span class="hljs-string">'./factories/users'</span>,
      <span class="hljs-attr">revert</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> ({
        <span class="hljs-attr">query</span>: <span class="hljs-string">'mutation deleteUser($id: ID!) { deleteUser(id: $id) }'</span>,
        <span class="hljs-attr">variables</span>: { <span class="hljs-attr">id</span> : data.id},
      }),
    },
  }
</code></pre>
<p>Then, calling <code>I.mutateData('createUser')</code> inside a test will create a new user for you.
This is done by sending a GraphQL mutation request over Http to <code>/graphql</code> endpoint. Response is returned and can be used in tests.</p>
<p>At the end of a test GraphQLDataFactory will clean up created record for you. This is done by collecting
data from crated records, creating deletion mutation objects by passing the data to the <code>revert</code> function provided, and sending deletion mutation objects as requests at the end of a test.
This behavior is according the <code>revert</code> function be customized in helper configuration.
The revert function returns an object, that contains the query for deletion, and the variables object to go along with it.</p>
<blockquote>
<p>See complete reference on <a href="http://codecept.io/helpers/GraphQLDataFactory">GraphQLDataFactory</a> helper</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="requests-using-browser-session"></a><a href="#requests-using-browser-session" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Requests Using Browser Session</h2>
<p>All the REST, GraphQL, GraphQLDataFactory, and ApiDataFactory helpers allow override requests before sending.
This feature can be used to fetch current browser cookies and set them to REST API or GraphQL client.
By doing this we can make requests within the current browser session without a need of additional authentication.</p>
<blockquote>
<p>Sharing browser session with ApiDataFactory or GraphQLDataFactory can be especially useful when you test Single Page Applications</p>
</blockquote>
<p>For example, let's see how to configure ApiDataFactory alongside with WebDriver to share cookies:</p>
<pre><code class="hljs css language-js">  ApiDataFactory: {
    <span class="hljs-attr">endpoint</span>: <span class="hljs-string">'http://local.app/api'</span>,
    <span class="hljs-attr">cleanup</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>,
    },
    <span class="hljs-attr">factories</span>: {
      <span class="hljs-attr">user</span>: {
          <span class="hljs-attr">uri</span>: <span class="hljs-string">"/users"</span>,
          <span class="hljs-attr">factory</span>: <span class="hljs-string">"./factories/user"</span>,
      }
    },
    <span class="hljs-attr">onRequest</span>: <span class="hljs-keyword">async</span> (request) =&gt; {
      <span class="hljs-keyword">let</span> cookies = <span class="hljs-keyword">await</span> codeceptjs.container.helpers(<span class="hljs-string">'WebDriver'</span>).grabCookie();
      request.headers = { <span class="hljs-attr">Cookie</span>: cookies.map(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${c.name}</span>=<span class="hljs-subst">${c.value}</span>`</span>).join(<span class="hljs-string">'; '</span>) };
    },
  }
  WebDriver: {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'https://local.app/'</span>,
    <span class="hljs-attr">browser</span>: <span class="hljs-string">'chrome'</span>,
  }
</code></pre>
<p>In this case we are accessing WebDriver helper. However, you can replace WebDriver with any helper you use.</p>
<p>The same can be done with GraphQLDataFactory.</p>
<p>The order of helpers is important! ApiDataFactory will clean up created users after a test,
so it needs browser to be still opened to obtain its cookies.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2019-8-15</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/bdd"><span class="arrow-prev">← </span><span>Behavior Driven Development</span></a><a class="docs-next button" href="/parallel"><span>Parallel Execution</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#rest">REST</a></li><li><a href="#graphql">GraphQL</a></li><li><a href="#data-generation-with-factories">Data Generation with Factories</a><ul class="toc-headings"><li><a href="#api-data-factory">API Data Factory</a></li><li><a href="#graphql-data-factory">GraphQL Data Factory</a></li></ul></li><li><a href="#requests-using-browser-session">Requests Using Browser Session</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.svg" alt="CodeceptJS" width="66" height="58"/></a><div><h5>Docs</h5><a href="/quickstart">QuickStart</a><a href="/basics">Guides</a><a href="/reference">Reference</a></div><div><h5>Community</h5><a href="https://join.slack.com/t/codeceptjs/shared_invite/enQtMzA5OTM4NDM2MzA4LWE4MThhN2NmYTgxNTU5MTc4YzAyYWMwY2JkMmZlYWI5MWQ2MDM5MmRmYzZmYmNiNmY5NTAzM2EwMGIwOTNhOGQ">Slack Chat</a><a href="https://codecept.discourse.group" target="_blank" rel="noreferrer noopener">Community Forum</a><a href="http://stackoverflow.com/questions/tagged/codeceptjs" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/codeceptjs" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="https://github.com/Codeception/CodeceptJS">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/codeception/codeceptjs/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><a href="http://sdclabs.com/codeceptjs?utm_source=codecept.io&amp;utm_medium=footer&amp;utm_term=link&amp;utm_campaign=reference">Commercial Support</a><a href="http://sdclabs.com/trainings/web-automation-codeceptjs?utm_source=codecept.io&amp;utm_medium=top_menu&amp;utm_term=link&amp;utm_campaign=reference">Trainings</a></div></section><section class="copyright">Copyright © 2019 CodeceptJS</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0cc13a0af567a05fc38790be681b1491',
                indexName: 'codecept',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>